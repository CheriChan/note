# http

[TOC]

## http协议构成

+ 请求行：Method Request-URI HTTP-Version 结尾符（结尾符一般用\r\n）

+ 请求头：

  **通用报头**

  | 属性          | 含义                                                         |
  | ------------- | ------------------------------------------------------------ |
  | Date          | 表示消息产生的日期和时间                                     |
  | Connection    | 允许发送指定连接的选项，例如指定连接是连续的，或者指定“close”选项，通知服务器，在响应完成后，关闭连接 |
  | Cache-Control | 用于指定缓存指令，缓存指令是单向的（响应中出现的缓存指令在请求中未必会出现），且是独立的（一个消息的缓存指令不会影响另一个消息处理的缓存机制） |

  **请求报头**

  | 属性              | 含义                                                         |
  | ----------------- | ------------------------------------------------------------ |
  | Host              | 请求的主机名，允许多个域名同处一个IP地址，即虚拟主机         |
  | User-Agent        | 发送请求的浏览器类型、操作系统等信息                         |
  | Accept            | 客户端可识别的内容类型列表，用于指定客户端接收那些类型的信息 |
  | Accept-Encoding   | 客户端可识别的数据编码                                       |
  | Accept-Language   | 表示浏览器所支持的语言类型                                   |
  | Connection        | 允许客户端和服务器指定与请求/响应连接有关的选项，例如这是为Keep-Alive则表示保持连接 |
  | Transfer-Encoding | 告知接收端为了保证报文的可靠传输，对报文采用了什么编码方式   |
  | Pragma            | 是否缓存,指定 no-cache 返回刷新                              |
  | Referer           | 页面路由                                                     |
  | If-Modified-Since | 值为时间                                                     |

  **响应报头**

  | 属性     | 含义                                                         |
  | -------- | ------------------------------------------------------------ |
  | Location | 用于重定向接受者到一个新的位置，常用在更换域名的时候         |
  | Server   | 包含可服务器用来处理请求的系统信息，与User-Agent请求报头是相对应的 |

  **实体报头**

  | 属性             | 含义                                                         |
  | ---------------- | ------------------------------------------------------------ |
  | Content-Type     | 发送给接收者的实体正文的媒体类型                             |
  | Content-Lenght   | 实体正文的长度                                               |
  | Content-Language | 描述资源所用的自然语言，没有设置则该选项则认为实体内容将提供给所有的语言阅读 |
  | Content-Encoding | 实体报头被用作媒体类型的修饰符，它的值指示了已经被应用到实体正文的附加内容的编码，因而要获得Content-Type报头域中所引用的媒体类型，必须采用相应的解码机制。 |
  | Last-Modified    | 实体报头用于指示资源的最后修改日期和时间                     |
  | Expires          | 实体报头给出响应过期的日期和时间                             |

+ 空行：http协议规定的格式，一般采用\r\n

+ 消息主体：一般用于http的post method。通过实体报头规定消息主体的格式内容、

  

  

## http/1特点

+ 无状态，每次通信都是独立的，不会保存通信过程中的各类信息
+ 传输可靠，基于TCP/IP协议进行传输，三次握手和四次挥手，让信息传输更稳定
+ 请求-应答， 一请求一响应
+ 灵活可扩展，传输数据多样化，文本，图片，音频

## http/1缺点

+ http的无状态特点，根据场景的不同，也会变成http的优缺点
  + 在需要长连接的场景中，需要保存大量的上下文信息，以免传输大量重复的信息，那么这时候无状态就是 http 的缺点了。
  + 有的通信仅仅是为了获取一些数据，不需要保存连接上下文信息，无状态反而减少了网络开销，成为了 http 的优点。

       + 明文传输，http传输的报文不是二进制而是文本形式
       + 对头堵塞，当 http 开启长连接时，共用一个 TCP 连接，同一时刻只能处理一个请求，那么当前请求耗时过长的情况下，其它的请求只能处于阻塞状态，也就是著名的**队头阻塞**问题

### HTTP1.0和HTTP1.1的区别

#### 请求头

| 属性名            | 含义                            |
| ----------------- | ------------------------------- |
| Accept            | 可接受的 MIME 类型              |
| Accept-Encoding   | 数据可解码的格式                |
| Accept-Language   | 可接受语言                      |
| Connection        | 值 keep-alive 是长连接          |
| Host              | 主机和端口                      |
| Pragma            | 是否缓存,指定 no-cache 返回刷新 |
| Referer           | 页面路由                        |
| If-Modified-Since | 值为时间                        |



+ 长连接：HTTP/1.1支持长连接和请求的流水线，在一个TCP连接上可以传送多个HTTP请求，避免了因为多次建立TCP连接的时间消耗和延时
+ **缓存处理**：HTTP/1.1引入`Entity tag，If-Unmodified-Since, If-Match, If-None-Match`等新的请求头来控制缓存
+ **带宽优化及网络连接的使用：** HTTP1.1则在请求头引入了range头域，支持断点续传功能
+ **Host头处理：** 在HTTP/1.0中认为每台服务器都有唯一的IP地址，但随着虚拟主机技术的发展，多个主机共享一个IP地址愈发普遍，HTTP1.1的请求消息和响应消息都应支持Host头域，且请求消息中如果没有Host头域会400错误

## HTTP/2.0新特性

+ **多路复用：** 即多个请求都通过一个TCP连接并发地完成，其实就是将请求数据分成帧乱序发送到 TCP 中。TCP 只能有一个 steam，所以还是会阻塞;
+ **服务端推送：** 服务端能够主动把资源推送给客户端，避免往返延迟
+ **新的二进制格式：** HTTP/2采用二进制格式传输数据，相比于HTTP/1.1的文本格式，二进制格式具有更好的解析性和拓展性
+ **header压缩：** HTTP/2压缩消息头，减少了传输数据的大小

![浏览器请求分析](D:\note\source\images\qq.png)

| 版本                                                         | 内容                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| http0.9                                                      | 只允许客户端发送 GET 这一种请求;且不支持请求头,协议只支持纯文本;无状态性,每个访问独立处理,完成断开;无状态码 |
| http1.0	解决 0.9 的缺点,增加 If-modify-since(last-modify)和 expires 缓存属性 |                                                              |
| http1.x                                                      | 增加 cache-control 和 If-none-match(etag)缓存属性            |
| http2.0                                                      | 采用二进制格式传输;多路复用;报头压缩;服务器推送              |
| http3.0                                                      | 采用 QUIC 协议,自定义连接机制;自定义重传机制;无阻塞的多路复用 |